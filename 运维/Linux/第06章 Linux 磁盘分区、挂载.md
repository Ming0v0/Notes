# Linux 磁盘分区、挂载
## 分区基础知识
磁盘分区是将硬盘划分为不同的逻辑部分的过程。每个分区可以被视为一个独立的磁盘，它具有自己的文件系统，并可以存储数据和文件。

**分区的方式**
MBR 分区
1. 最多支持四个主分区
2. 系统只能安装在主分区
3. 扩展分区要占一个主分区
4. MBR 最大只支持 2TB，但拥有最好的兼容性

GTP 分区
1. 支持无限多个主分区（但操作系统可能限制，比如 windows 下最多 128 个分区）
2. 最大支持 18EB 的大容量（1EB=1024 PB，1PB=1024 TB  ）
3. windows7 64 位以后支持 gtp

**windows 下的磁盘分区**
Windows的磁盘分区原理是基于磁盘分区表（Partition Table）来管理磁盘的分区。分区表存储在硬盘的第一个扇区，通常称为主引导记录（Master Boot Record，MBR）或GUID分区表（GUID Partition Table，GPT）。磁盘分区表记录了硬盘上所有分区的位置和大小，使操作系统能够正确地识别和访问这些分区。

在Windows中，常用的分区工具有磁盘管理器（Disk Management）和命令行工具DiskPart。这些工具提供了创建、删除、调整和格式化分区的功能。

Windows支持两种主要的分区类型：主分区和扩展分区。主分区是可以直接被操作系统引导的分区，而扩展分区则可以容纳多个逻辑分区。一个硬盘最多可以有四个主分区或三个主分区加一个扩展分区。

每个分区都可以分配一个驱动器号或挂载点，以便操作系统可以访问和管理分区中的文件和数据。分区可以被格式化为不同的文件系统，如FAT32、NTFS等，不同的文件系统会影响文件存储的方式和限制。

磁盘分区的好处是可以更好地组织数据，提高存储空间的利用率，同时可以方便地对不同的分区进行备份和恢复。此外，磁盘分区还可以提高系统的性能，因为操作系统可以更好地管理和访问不同的分区。

![](attachment/Pasted%20image%2020230912231437.png)

**Linux 分区**
**原理介绍**
Linux 来说无论有几个分区，分给哪一目录使用，它归根结底就只有一个根目录，一个独立且唯一的文件结构 , Linux 中每个分区都是用来组成整个文件系统的一部分。

Linux 采用了一种叫“载入”的处理方法，它的整个文件系统中包含了一整套的文件和目录， 且将一个分区和一个目录联系起来。这时要载入的一个分区将使它的存储空间在一个目录下获得。

示意图
![](attachment/Pasted%20image%2020230912231725.png)


**硬盘说明**
Linux 硬盘分 IDE 硬盘和 SCSI 硬盘，目前基本上是 SCSI 硬盘

对于 IDE 硬盘，驱动器标识符为“hdx~”,其中“hd”表明分区所在设备的类型，这里是指 IDE 硬盘了。“x”为盘号（a 为基本盘，b 为基本从属盘，c 为辅助主盘，d 为辅助从属盘）,“~”代表分区， 前四个分区用数字 1 到 4 表示，它们是主分区或扩展分区，从 5 开始就是逻辑分区。例，hda3 表示为第一个IDE 硬盘上的第三个主分区或扩展分区,hdb2 表示为第二个IDE 硬盘上的第二个主分区或扩展分区。

对于 SCSI 硬盘则标识为“sdx~”，SCSI 硬盘是用“sd”来表示分区所在设备的类型的，其余则和 IDE 硬盘的表示方法一样。

**使用lsblk 指令查看当前系统的分区情况**
![](attachment/Pasted%20image%2020230912232706.png)

![](attachment/Pasted%20image%2020230912232709.png)



## 如何增加一块硬盘

挂载的经典案例
需求是给我们的 Linux 系统增加一个新的硬盘，并且挂载到/home/newdisk

虚拟机添加硬盘

分区    
```txt
fdisk /dev/sdb
```

格式化  
```txt
mkfs -t ext4  /dev/sdb1
```

挂载   
先创建一个被挂载的目录
```txt
/home/newdisk
```
挂载 
```txt
mount /dev/sdb1 /home/newdisk
```

设置可以自动挂载(永久挂载，当你重启系统，仍然可以挂载到 /home/newdisk) 。

```txt
vim  /etc/fstab

文件内容
/dev/sdb1  /home/newdisk   ext4   defaults   0 0
```

**具体的操作步骤整理**

**虚拟机增加硬盘步骤 1**
![](attachment/Pasted%20image%2020230912233835.png)
在【虚拟机】菜单中，选择【设置】，然后设备列表里添加硬盘，然后一路【下一步】，中间只有选择磁盘大小的地方需要修改，至到完成。然后重启系统（才能识别）

---

**虚拟机增加硬盘步骤 2**

分区命令  
```txt
fdisk  /dev/sdb
```

开始对/sdb 分区
- m    显示命令列表
- p     显示磁盘分区 同 fdisk    –l
- n     新增分区
- d     删除分区
- w    写入并退出
说明： 开始分区后输入 n，新增分区，然后选择 p ，分区类型为主分区。两次回车默认剩余全部空间。最后输入 w 写入分区并退出，若不保存退出输入 q。
![](attachment/Pasted%20image%2020230912234009.png)

---

**虚拟机增加硬盘步骤 3**
格式化磁盘
分区命令
```txt
mkfs -t ext4 /dev/sdb1
```
其中 ext4 是分区类型

---

**虚拟机增加硬盘步骤 4**

挂载
将一个分区与一个目录联系起来，

```txt
mount 设备名称 挂载目录
```

例如
```txt
mount /dev/sdb1 /newdisk
```

卸载分区
```txt
umount   设备名称 或者   挂载目录
```

例如  
```txt
umount /dev/sdb1 
umount /newdisk
```

---

**虚拟机增加硬盘步骤 5**

永久挂载:  通过修改`/etc/fstab` 实现挂载添加完成后 执行 `mount –a` 即刻生效

![](attachment/Pasted%20image%2020230912234440.png)

## 磁盘情况查询
### 查询系统整体磁盘使用情况

基本语法
```txt
df -h
```

演示
查询系统整体磁盘使用情况
![](attachment/Pasted%20image%2020230912234917.png)

### 查询指定目录的磁盘占用情况

基本语法
```txt
du -h    /目录
```

查询指定目录的磁盘占用情况，默认为当前目录
- -s 指定目录占用大小汇总
- -h 带计量单位
- -a 含文件
- --max-depth=1    子目录深度
- -c 列出明细的同时，增加汇总值

演示
查询 /opt 目录的磁盘占用情况，深度为 1
![](attachment/Pasted%20image%2020230912235054.png)

### 磁盘情况-工作实用指令
统计/home 文件夹下文件的个数
![](attachment/Pasted%20image%2020230912235319.png)

统计/home 文件夹下目录的个数
![](attachment/Pasted%20image%2020230912235744.png)

统计/home 文件夹下文件的个数，包括子文件夹里的
![](attachment/Pasted%20image%2020230912235758.png)

统计文件夹下目录的个数，包括子文件夹里的
![](attachment/Pasted%20image%2020230912235820.png)

以树状显示目录结构
![](attachment/Pasted%20image%2020230912235841.png)

