# 程序查询方式

![](attachment/Pasted%20image%2020231005005800.png)
在这种方式下，利用查询方式进行输入/输出，就是通过 CPU 执行程序来查询外设的状态判断外设是否准备好接收数据或准备好了向 CPU 输入的数据。根据这种状态，CPU 有针对性地为外设的输入/输出服务。

通常，一个计算机系统中可以存在着多种不同的外设，如果这些外设是用查询方式工作，则 CPU 应对这些外设逐一进行查询，发现哪个外设准备就绪就对该外设服务

- 降低了CPU 的效率。在这种工作方式下，CPU 不做别的事，只是**不停地对外设的状态进行查询。** 在实际的工程应用中，对于那些慢速的外设，在不影响外设工作的情况下，CPU 应可以执行其他任务。
- 对外部的突发事件无法做出实时响应
-  一次只能读/写一个字
- 由CPU将数据放入内存

# 中断驱动方式

由程序控制IO 的方法，其主要缺点在于 CPU 必须等待 IO 系统完成数据的传输任务，在此期间 CPU 需定期地查询 IO 系统的状态，以确认传输是否完成。因此，整个系统的性能严重下降。

利用中断方式完成数据的输入/输出过程为：当IO 系统与外设交换数据时，CPU 无须等待也不必去查询 I/O 的状态，而可以抽身出来处理其他任务。当 IO 系统准备好以后，则发出中断请求信号通知 CPU，CPU 接到中断请求信号后，保存正在执行程序的现场，转入 IO 中断服各程序的执行，完成与 IO 系统的数据交换，然后再返回被打断的程序续执行。与程序控制方式相比，中断方式因为 CPU 无须等待而提高了效率。

## 中断处理方法

在系统中具有多个中断源的情况下，常用的处理方法有多中断信号线法(Multiple InterruptLines)、中断软件查询法 (Software Poll) 、菊花链法(Daisy Chai) 、总线仲裁法和中断向量表法。

- 多中断信号线法。每个中断源都有属于自己的一根中断请求信号线向 CPU 提出中断请求。
- 中断软件查询法。当 CPU 测到一个中断请求信号以后，即转入到中断服务程序去轮询每个中断源以确定是谁发出了中断请求信号。对各个设备的响应优先级由软件设定。
- 菊花链法。软件查询的缺陷在于花费的时间太多。菊花链法实际上是一种硬件查询法。所有的IO 模块共享一根共同的中断请求线，而中断确认信号则以链式在各模块间相连。当 CPU检测到中断请求信号时，则发出中断确认信号。中断确认信号依次在 I/O 模块间传递，直到发出请求的模块，该模块则把它的 Date 送往数据线由 CPU 读取。
- 总线仲裁法。一个 IO 设备在发出中断请求之前，必须先获得总线控制权，所以可由总线仲裁机制来裁定谁可以发出中断请求信号。当 CPU 发出中断响应信号后，该设备即把自己的 发往数据线。
- 中断向量表法。中断向量表用来保存各个中断源的中断服务程序的入口地址。当外设发出中断请求信号 (INTR) 以后，由中断控制器(INTC)确定其中断号，并根据中断号查找中断向量表来取得其中断服务程序的入口地址，同时INTC 把中断请求信号提交给 CPU，如图1-15 所示。中断源的优先级由 ITC 来控制。

# 直接存储器方式（DMA）

在计算机与外设交换数据的过程中，无论是无条件传送、利用查询方式传送还是利用中断方式传送，都需要由 CPU 通过执行程序来实现，这就限制了数据的传送速度。

直接内存存取 (Direct Memory Access，DMA) 是指数据在内存与 IO 设备间的直接**成块传送**，即在内存与IO 设备间传送一个数据块的过程中，**不需要CPU 的任何干涉，只需要 CPU在过程开始启动(即向设备发出“传送一块数据”的命令) 与过程结束 (CPU 通过轮询或中断得知过程是否结束和下次操作是否准备就绪) 时的处理**，实际操作由 DMA 硬件直接执行完成，CPU 在此传送过程中可做别的事情。

DMA 传送的一般过程如图所示
![](attachment/Pasted%20image%2020231005192757.png)

1. 外设向 DMA 控制器 (DMAC) 提出 DMA 传送的请求。
2. DMA 控制器向 CPU 提出请求，其请求信号通常加到 CPU 的保持请求输入端 HOLD 上。
3. CPU 在完成当前的**总线周期**后立即对此请求作出响应，CPU 的响应包括两个方面的内容：一方面，CPU 将有效的保持响应信号 HLDA 输出加到DMAC 上，告诉 DMAC 它的请求已得到响应；另一方面，CPU 将其输出的总线信号置为高阻，这就意味着 CPU 放弃了对总线的控制权。
4. 此时，DMAC 获得了对系统总线的控制权，开始实施对系统总线的控制。同时向提出请求的外设送出 DMAC 的响应信号，告诉外设其请求已得到响应，现在准备开始进行数据的传送。