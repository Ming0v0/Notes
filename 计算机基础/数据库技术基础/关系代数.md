# 关系模型

## 关系模型中基本术语
关系数据库系统是支持关系模型的数据库系统。有关关系模型的一些基本术语如下
- 关系：一个关系就是一张二维表，每个关系有一个关系名。
- 元组：表中的一行即为一个元组，对应存储文件中的一个记录值。
- 属性：表中的列称为属性，每一列有一个属性名。属性值相当于记录中的数据项或者字段值。
- 域：属性的取值范围，即不同元组对同一个属性的值所限定的范围。例如，逻辑型属性只能从逻辑真 (如T)或逻辑假(如F)两个值中取值。
- 关系模式：对关系的描述称为关系模式，由关系名和其属性集合构成，关系模式的格式为`关系名(属性名1,属性名2,...,属性名3)`

通常一个关系模式对应一个关系文件的结构。例如，以下关系模式对应学生数据库的学生表结构

- 候选码(或候选键)：属性或属性组合，其值能够唯一地标识一个元组
- 主码(或主键): 在一个关系中可能有多个候选码，从中选择一个作为主码。
- 主属性：包含在任何候选码中诸属性称为主属性，不包含在任何候选码中诸属性称为非码属性。
- 外码(或外键)：如果一个关系中的属性或属性组并非该关系的码，但它们是另外一个关系的码，则称其为该关系的外码。
- 全码：关系模式的所有属性组是这个关系模式的候选码，称为全码。超码 (超键):一个包含码的属性集称为超码，例如学号是码，则 (学号，姓名)就是一个超码。

![](attachment/Pasted%20image%2020231014103229.png)

可以将关系定义为元组的集合，关系模式则是指定的属性集合，元组是属性值的集合。
个具体的关系模型是若千个关系模式的集合。

## 关系模型的定义
关系的描述称为关系模式，它可以形式化地表示为: `R(U，D，dom，F)`
其中R为关系名，U为组成该关系的属性名集合，D为属性组U中属性所来自的域，dom为属性向域的映象集合，F为属性间数据的依赖关系集合。

通常简记为$R(U)$或$R(A_1,A_2...A_n)$，其中R为关系名，U为属性名集合，$A_1,A_2...A_n$,为各属性名。

关系模型由关系数据结构、关系操作集合和关系完整性约束三部分组成。

**关系模型中的关系数据结构**
关系模型中数据的逻辑关系是一张二维表格

**关系模型中的关系操作集合**
关系模型给出了关系操作的能力，但不对RDBMS(关系数据库管理系统)语言给出具体的语法要求。常用的关系操作有:选择、投影、连接、除、并、交、差等查询操作和增加、删除操作等。

早期的关系操作能力通常用代数方式或逻辑方式来表示，分别称为关系代数和关系演算。关系代数是用对关系的运算来表达查找要求的方式，关系演算是用谓词来表达查询要求的方式。关系演算又可按调词变元的基本对象是元组变量还是域变量，分为元组关系演算和域关系演算。

关系代数、元组关系演算和域关系演算 3 种语言在表达能力上是完全等价的。

**关系模型中的关系完整性约束**
关系模型中的 3 个完整性规则如下
- 实体完整性: 关系中主码的值不能为空或部分为空。也就是说，主码中属性即主属性不能取空值。
- 参照完整性：如果关系 $R_2$的外码 X 与关系 $R_1$ 的主码相对应(基本关系$R_1$和$R_2$不一定是不同的关系，即它们可以是同一个关系)，则外码 X 的每个值必须在关系$R_1$，中主码的值中找到，或者为空值。
- 用户定义的完整性: 指用户对某一具体数据指定的约束条件进行检验

# 关系数据库的基本概念

**属性和域**
在现实世界中，要描述一个事物，常常取其若干特征来表示，这些特征称为属性。每个属性的取值范围所对应的一个值的集合，称为该属性的域。

一般在关系数据库模型中，对域还加了一个限制，所有的域都应是原子数据的集合。关系数据模型的这种限制称为第一范式(INF)条件。如果关系数据模型突破了INF的限制，则称为非1NF的。

**笛卡儿积与关系**

设$D_1,D_2,...,D_n$为任意集合，定义 $D_1,D_2,...,D_n$ 的笛卡儿积为
$$\ D_1×D_2×...×D_n=\{(d_1,d_2,...,d_n)|d_i\in D_i,i=1,2,...,n\} $$
其中，每一个元素$(d_1,d_2,d_3,.…..d_n)$叫作一个n元组
例如：$D_1=\{0,1\},D_2=\{a,b,c\}$
则：$D_1×D_2=\{(0,a),(0,b),(0,c),(1,a),(1,b),(1,c)\}$

关系

笛卡尔积 $D_1×D_2×...×D_n$,的任一个子集称为$D_1×D_2×...×D_n$上的一个n 元关系。

同样可以把关系看成二维表，给表的每一列取一个名称，称为属性。n 元关系有 n 个属性，属性的名称要唯一，属性的取值范围 $D_i(i=1,...,n)$叫值域。例如，$R_1=\{(0,a),(0,b),(0,c)\},R_2=\{(1,a),(1,b),(1,c)\}$都是上例 $D_1×D_2$上的一个关系


## 关系运算

关系代数是施加于关系之上的一组集合代数运算，每个运算都以一个或多个关系作为运算对象，并生成另外一个关系作为该关系运算的结果。关系代数包含传统的集合运算和专门的关系运算两类。

![](attachment/Pasted%20image%2020231014111926.png)

**关系代数运算**


**关系的并**
关系 R 和关系 S 的所有元组合并，再删去重复的元组，组成一个新关系，称为 R和S的并，记为 RUS。

**关系的差**
关系 R 和关系 S 的差是由属于 R 而不属于 S 的所有元组组成的集合，即关系 R 中删去与关系 S 中相同的元组，组成一个新关系，记为 R-S。

**关系的交**
关系 R 和关系 S 的交是由既属于 R 又属于 S 的元组组成的集合，即在两个关系 R与S中取相同的元组，组成一个新关系，记为 R∩S。有 R∩S=R-(R-S)成立

设 R 中有 m 个元组，s 中有n个元组，两者有k个元组相同，则:
- RUS中元组数为m+n-k
- R∩S 中元组数为 k。
- R-S中元组数为mk。

![](attachment/Pasted%20image%2020231014112832.png)

**投影**
投影运算是从**关系的垂直方向进行运算**，在关系 R 中选出若干属性列 A 组成新的关系，记作元,(R)，其形式定义如下
$$\pi_A(R)=\{t[A]|t\in R\}$$
![](attachment/Pasted%20image%2020231014114544.png)
**选择**

选择运算是从关系的水平方向进行运算，是从关系 R 中选择满足给定条件的诸元组，记作 $\sigma_F(R)$，其形式定义如下
$$\sigma_F(R)=\{t|t\in R\land F(t)==Ture\}$$
其中，F中的运算对象是属性名(或列的序号) 或常数，运算符、算术比较符($<、\leq、>、\geq$)和逻辑运算符 ($\land、\lor、\lnot$)。

例如，$\sigma_{1\geq6}(R)$表示选 R 关系中第 1 个属性值大于等于第6 个属性值的元组; $\sigma_{1\geq'6'}(R)$表示选取 R 关系中第 1 个属性值大于等于 6 的元组。

![](attachment/Pasted%20image%2020231014115810.png)

**连接**
连接分为 $\theta$ 连接、等值连接和自然连接 3 种。

连接运算是从两个关系R和S的笛卡儿积中选取满足条件的元组。因此，可以认为笛卡儿积是无条件连接，其他的连接操作认为是有条件连接，下面分别介绍。

$\theta$ 连接。
从 R与 S的笛卡儿积中选取属性间满足一定条件的元组。记作
![](attachment/Pasted%20image%2020231014133658.png)
其中，X$\theta$ Y 为连接的条件，$\theta$  是比较运算符，X和Y分别为 R和 S上度数相等且可比的属性组。$t^n[X]$表示 $R$ 中 $t^n$ 元组的对应于属性X的一个分量。$t^m[Y]$表示 S 中 $t^m$ 元组的对应于属性Y的一个分量。有如下说明。
![](attachment/Pasted%20image%2020231014133954.png)

等值连接
等值连接。当 $\theta$ 为 "=”时，称之为等值连接，记为RA S，其形式定义如下
![](attachment/Pasted%20image%2020231014134638.png)

自然连接
自然连接是除去重复属性的等值连接，它是连接运算的一个特例，是最常用的连接运算。
自然连接记为R  S，其中R和S是两个关系，并且具有一个或多个同名属性。在连接运算中，同名属性一般都是外关键字，否则会出现重复数据。具体计算过程如下:
D 计算RxS;
设R和S的公共属性是$A_!...A_k$，挑选R×S中满足$R.A1=S.A···R.A=S.A.$的那些元组:23 去掉S.A1.··S.A这些列(保留R.A···R.Ak)。