# 共享型以太网

交换网络是通信系统的重要组成部分，主要用来完成信息交换的功能。交换网络的出现有效解决了传统共享型以太网的冲突域问题，常见设备有集线器、交换机。

最初的以太网采用了总线型拓扑，**各个主机之间共用一条同轴电缆进行通信**，它们共享这条通信链路的带宽。这意味着无论哪一台主机发送数据，其余的主机都能收到。
![](attachment/Pasted%20image%2020250214103408.png)
同时，也可能有这样一种场景，当一台主机正在发送数据时，另一台主机也开始发送数据，或者两台主机同时开始发送数据，**他们的数据信号就会在信道内碰撞，互相干扰，使得数据信号被破坏，导致通信中断**
![](attachment/Pasted%20image%2020250214103445.png)
- 采用了总线型拓扑
- 共享通信链路的带宽
- 数据信号就会在信道内碰撞产生冲突

## CSMA/CD协议

为了解决这些计算机同时发送数据会产生冲突的问题，**共享型以太网在任意时刻仅允许一台主机发送数据**，因此每台主机并不能占有所有带宽。

随着接入的主机数量越来越多，主机的通信速率将越来越低。为了解决多台计算机同时发送数据时产生的冲突问题，引入了CSMA/CD协议。

CSMA/CD协议的工作过程
1. 侦听信道上是否有信号在传输。如果有的话，表明信道处于忙状态，就继续侦听，直到信道空闲为止
2. 若没有侦听到任何信号，就传输数据
3. 传输时继续侦听，如发现冲突则执行退避算法，随机等待一段时间后，重新执行步骤1
4. 若未发现冲突则发送成功，计算机会返回到侦听信道状态。

## 冲突与冲突域
![](attachment/Pasted%20image%2020231125095126.png)


影响冲突产生的因素：冲突是影响以太网性能的重要因素，冲突的存在使得传统的以太网在负载超过40%时，效率将明显下降。

产生冲突的原因有很多，例如，同一冲突域中节点的数量越多，产生冲突的可能性就越大。此外，诸如数据分组的长度（以太网的最大帧长度为1518字节）、网络的直径等因素也会影响冲突的产生。因此，当以太网的规模增大时，就必须采取措施来控制冲突的扩散。通常的办法是使用网桥和交换机将网络分段，将一个大的冲突域划分为若干个小的冲突域。

在共享型以太网中，任意两台及以上设备同时发送数据就会造成冲突，它们共同构成了一个冲突域。
- 冲突（Collision）：在以太网中，当两个数据帧同时被发到物理传输介质上，并完全或部分重叠时，就发生了数据冲突。当冲突发生时，将导致数据损坏。
- 冲突域：连接到同一个共享介质的设备共同组成了一个冲突域。


# 交换机简介

共享式以太网在扩展性能上很差，且随着设备数量增加，发生冲突的概率也增加，因此它无法应对大型网络。交换机正是基于这个背景被设计出来的。

![](attachment/Pasted%20image%2020231125095349.png)

**交换机能识别以太网数据帧的源和目标MAC地址，并将数据帧从与目的设备相连的端口转发出去**，而不会像集线器那样向不需要这个数据帧的接口发送数据帧。

**以太网交换机的特点**
- 交换机工作在数据链路层
- 交换机的每一个端口都是一个独立的冲突域
- 交换机以端口隔离冲突域形成交换型以太网

## 广播域
交换机通过自己的接口来隔离冲突域，但并不表示交换型以太网中连接的设备之间只能实现一对一的数据交互，有时，域网中的一台终端设备确实需要向局域网中的所有其他终端设备发送消息。

![](attachment/Pasted%20image%2020231125095514.png)


- 广播：一台设备向同一个网络中的所有其他设备发送消息的数据发送方式
- 广播域：广播帧可达的区域，即接收同样广播消息的节点的集合
- 广播域的分类：二层广播域和三层广播域

## 交换机数据帧的转发方式 
**学习**：当交换机通过自己的某个接口接收到一个数据帧时，它就会将这个数据帧的源MAC地址和接收到这个数据帧的接口编号作为一个条目保存在自己的MAC地址表中
![](attachment/Pasted%20image%2020231125095824.png)


**转发**：在MAC地址表中找到了该目标MAC地址，且该数据帧的源MAC和目的MAC对应的端口号不同。交换机会将该数据帧从目标MAC对应的端口号转发出去，如交换机将会把PC0发给PC2的数据帧从E2端口转发出去。
![](attachment/Pasted%20image%2020231125095858.png)


**广播**：由于交换机的MAC地址表中没有记录这个数据帧的目的MAC地址，因此，它无法处理该数据帧，于是，交换机只能将该数据帧从所有其他端口发送出去。

![](attachment/Pasted%20image%2020231125100147.png)

**丢弃**：在MAC地址表中找到了该目标MAC地址，且该数据帧的源MAC地址和目的MAC地址对应的端口号相同。交换机E0所在端口为一个冲突域，PC0和PC1在一个冲突域中，因此，交换机和PC1都会收到PC0发给PC1的数据包，由此，交换机并不需要处理该数据帧，因此丢弃。

![](attachment/Pasted%20image%2020231125095957.png)

- 更新：交换机MAC地址表的默认老化时间是300秒。


